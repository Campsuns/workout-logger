/* ===============================================================
   Workout Logger — UI polish + data-scoped themes
   =============================================================== */

/* ---- Base palette & theme ---- */
:root{
  --bg:#0b0b0c;
  --fg:#ffffff;
  --muted:#a0a0a8;
  --soft:#15161b;
  --card:#111216;
  --line:#23242b;
  --glass: rgba(10,11,15,0.62);
  --glass-bd:#1d1e25;

  --accent:#2bd2c8;  --accent-r:45; --accent-g:212; --accent-b:191;
  --accent-weak: rgba(43,210,200,0.20);

  --chip-h:40px; --chip-px:14px; --radius:12px;
  --done-bd:#21443f;      /* card border for done */
  --done-pill:#1f5d55;    /* reps/sets pill border for done */
  --done-text:#b6fff2;    /* reps/sets pill text for done */
}
body.annie{
  --accent:#c9a7ff;  --accent-r:201; --accent-g:167; --accent-b:255;
  --accent-weak: rgba(201,167,255,0.22);
  /* Dimmed purple for done state (border slightly translucent, pill a touch softer) */
  --done-bd: rgba(var(--accent-r),var(--accent-g),var(--accent-b), 0.42);
  --done-pill: rgba(var(--accent-r),var(--accent-g),var(--accent-b), 0.75);
  --done-text: #efe6ff; /* light lavender text */
}

/* Resets */
*{ box-sizing:border-box; }
html,body{ margin:0; padding:0; background:var(--bg); color:var(--fg);
  font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}

/* Flash */
#flash{ position:fixed; inset:0; background:rgba(var(--accent-r),var(--accent-g),var(--accent-b),.35); opacity:0; pointer-events:none; }
#flash.show{ animation: flash 650ms ease-in-out; }
@keyframes flash{ 0%{opacity:0;} 20%{opacity:.22;} 100%{opacity:0;} }

/* USER BAR */
.user-bar{
  padding: calc(env(safe-area-inset-top) + 12px) 16px 10px;
  display:grid; grid-template-columns:1fr 1fr; gap:12px; width:100%;
}
.user-chip{
  height:var(--chip-h); padding:0 var(--chip-px); width:100%;
  background:var(--soft); color:var(--fg);
  border:1px solid var(--line); border-radius:var(--radius);
  display:inline-flex; align-items:center; justify-content:center;
  font-weight:800; font-size:13px;
}
.user-chip.active{
  border-color:var(--accent);
  box-shadow:inset 0 0 0 2px var(--accent-weak);
}

/* HEADER (frosted + feather) */
.topbar{
  display:grid; grid-template-columns:1fr 1fr; align-items:center; column-gap:12px;
  position:sticky; top:0; z-index:50;
  padding:6px 16px 10px;
  background:var(--glass);
  border-bottom:1px solid var(--glass-bd);
  backdrop-filter:saturate(120%) blur(13px);
  -webkit-backdrop-filter:saturate(120%) blur(13px);
}
.topbar::after{
  content:""; position:absolute; left:0; right:0; bottom:-22px; height:22px;
  background:linear-gradient(var(--glass), rgba(0,0,0,0));
  pointer-events:none;
}
.topbar .brand{
  grid-column:1/2;
  font-weight:700; letter-spacing:.25px; font-size:18px;
  transform: translateY(-2px);
}

/* NAV (Workouts/Summary) — dashed chips to match +New/Reset */
.nav-tabs{
  grid-column:2/3;
  display:grid; grid-template-columns:1fr 1fr; gap:12px;
}
.nav-tabs button{
  height:var(--chip-h); padding:0 var(--chip-px); width:100%;
  background:var(--soft); color:var(--fg);
  border:1px dashed var(--line); border-radius:var(--radius);
  font-weight:700; font-size:13px;
}
.nav-tabs button.active{
  border-color:var(--accent);
  box-shadow:inset 0 0 0 2px var(--accent-weak);
  background:transparent; color:var(--fg);
}

/* FILTER BAR */
.filters{
  position:sticky; top:56px; z-index:40;
  padding:10px 16px 12px;
  background:var(--glass);
  border-bottom:1px solid var(--glass-bd);
  backdrop-filter:saturate(120%) blur(11px);
  -webkit-backdrop-filter:saturate(120%) blur(11px);
  display:grid; grid-template-columns:1fr 1fr; gap:12px;
}
.filters::after{
  content:""; position:absolute; left:0; right:0; bottom:-24px; height:24px;
  background:linear-gradient(var(--glass), rgba(0,0,0,0)); pointer-events:none;
}
.filters .btnrow{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }

/* Selects same size as +New/Reset (not bold) */
select, input, button, textarea{ font:inherit; }
.filters select{
  width:100%; height:var(--chip-h); padding:0 12px;
  background:#15161b; color:#fff; border:1px solid var(--line);
  border-radius:var(--radius); font-size:13px; font-weight:500;
  display:inline-flex; align-items:center;
}
button{ cursor:pointer; }
button.ghost{
  background:#15161b; color:#e6e6e6;
  border:1px dashed var(--line); border-radius:var(--radius);
  height:var(--chip-h); padding:0 var(--chip-px);
  font-weight:700; font-size:13px;
}
#btnAddExercise, #btnResetDone{ width:100%; }

/* PADDING AROUND CONTENT (breathing room) */
.page, .split-wrap, .summary{ padding: 0 16px 16px; }

/* CARDS */
.cards{ display:grid; grid-template-columns:1fr; gap:10px; }
.card{
  background:var(--card); border:1px solid #191a20; border-radius:16px;
  padding:12px; display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center;
}
.card:hover{ border-color:#2a2b32; }
.card .left{ display:flex; flex-direction:column; gap:3px; min-width:0; }
.name-line{ display:flex; align-items:baseline; gap:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.name{ font-weight:700; } /* match nav weight */
.variation{ font-size:13px; color:#aeb0b9; font-weight:600; }

.line.meta{ color:#aeb0b9; font-size:13px; }
.line.weight{ color:#e8e9ef; font-size:14px; font-weight:700; }

/* Subtle previous set line: (weight × reps × sets) */
.prevline{
  color:#aeb0b9;
  opacity:.66;
  font-size:12px;
  font-weight:400;
  font-variant-numeric: tabular-nums;
  letter-spacing:.1px;
}
.card .prevline{ margin-top:2px; }
#logSub .prevline{ display:inline; margin:0 0 0 6px; }

.weight .prevline{ font-weight:400; }

.pill.repsets{
  display:inline-flex; align-items:center; justify-content:center;
  background:transparent; color:#cfcfd6;
  border:1px solid var(--accent); border-radius:999px;
  min-width:98px; padding:8px 12px; white-space:nowrap; font-variant-numeric:tabular-nums;
}
.card.done{ border-color:var(--done-bd); box-shadow:0 0 0 1px var(--done-bd) inset; }
.card.done .repsets{ border-color:var(--done-pill); color:var(--done-text); }

/* DIALOGS (log + add) */
dialog{ width:100%; max-width:520px; border:none; border-radius:20px; padding:0; background:#0d0e12; color:#fff; }
dialog::backdrop{ background:rgba(0,0,0,.6); backdrop-filter: blur(4px); }
.logform{ padding:24px; }
.stack{ display:flex; flex-direction:column; gap:16px; }
.stepper{ background:#0f1015; border:1px solid #1f2028; border-radius:16px; padding:14px; text-align:center; }
.stepper label{ display:block; font-weight:700; font-size:12px; color:#c7c7d0; letter-spacing:.4px; }
.stepper .ctr{
  margin-top:6px;
  display:grid;
  grid-template-columns: 40px minmax(68px,1fr) 40px;
  align-items:center;
  gap:12px;
  height:40px;
}
.stepper .ctr button{
  width:40px; height:40px; border-radius:12px; background:#15161b; border:1px solid #23242b; color:#fff;
  display:flex; align-items:center; justify-content:center;
  padding:0; line-height:1; font-size:16px;
}
.stepper .ctr span{
  display:flex; align-items:center; justify-content:center;
  height:40px; min-width:68px; text-align:center;
  font-size:22px; font-weight:800; line-height:1; letter-spacing:0;
  font-variant-numeric: tabular-nums;
}
.seg{ display:flex; align-items:center; justify-content:space-between; background:#0f1015; border:1px solid #1f2028; border-radius:16px; padding:12px; }
.seg span{ color:#c7c7d0; font-weight:700; font-size:12px; }
.seg-buttons{ display:flex; gap:8px; }
.seg-buttons button{ flex:1; background:#15161b; border:1px solid #23242b; color:#fff; padding:10px 12px; border-radius:12px; }
/* Removed background highlight from active buttons to rely on highlight bar */
/* .seg-buttons button.active{ border-color:var(--accent); box-shadow: inset 0 0 0 2px var(--accent-weak); background:transparent; color:#e6fff9; } */
textarea{ width:100%; min-height:72px; background:#0f1015; border:1px solid #1f2028; border-radius:14px; padding:12px; color:#fff; resize:none; }

menu{ display:flex; gap:12px; justify-content:flex-end; margin:12px 0 0; padding:0; }
menu .sp{ flex:1 1 0; min-width:0; }
menu button{ height:var(--chip-h); padding:0 var(--chip-px); border-radius:var(--radius); border:1px dashed var(--line); background:#111216; color:#fff; font-weight:700; border-radius:12px; }
#btnLog{ background:var(--accent); border:1px solid var(--accent); color:#05231e; font-weight:800; border-radius:12px; }

/* SUMMARY period tabs */
.period-tabs {
  display: flex;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 16px;
  position: sticky;
  top: 56px;
  background: var(--glass);
  border-bottom: 1px solid var(--glass-bd);
}
.period-tabs button {
  height: var(--chip-h);
  padding: 0 var(--chip-px);
  background: transparent;
  color: var(--fg);
  border: none;
  outline: none;
  box-shadow: none;
  border-radius: 8px;
  font-weight: 700;
  font-size: 13px;
  transition: transform 0.3s ease, background 0.3s ease;
}
.period-tabs button.active {
  background: var(--accent);
  color: #000;
  border-radius: 8px;
  transition: transform 0.3s ease, background 0.3s ease;
}

/* MISC */
.group-title{ color:#c7c7d0; font-size:12px; letter-spacing:.2px; margin:14px 0 8px; padding: 0 16px; }
.subgroup{ margin-bottom:12px; }
.filters select, .filters button, #btnAddExercise, #btnResetDone, .user-chip, .nav-tabs button, .period-tabs button{
  display:inline-flex; align-items:center; justify-content:center; transform: translateY(-2px);
}
.stepper .ctr button, .period-tabs button, .filters button{ touch-action: manipulation; -webkit-user-select: none; user-select: none; }


/* PAGE visibility */
.page{ display:none; }
.page.active{ display:block; }

/* Hide filters when on summary page */
body[data-page="summary"] .filters{ display:none; }


/* Hide split sections when viewing Summary */
body[data-page="summary"] #selectedSplitWrap,
body[data-page="summary"] #otherTitle { display: none !important; }


/* ---- Optimistic & Stepper Pulse ---- */
:root{ --danger:#ff5b6b; --danger-r:255; --danger-g:91; --danger-b:107; }

@keyframes pulseUp {
  0%   { box-shadow: 0 0 0 0 rgba(var(--accent-r),var(--accent-g),var(--accent-b), .35); }
  100% { box-shadow: 0 0 0 14px rgba(var(--accent-r),var(--accent-g),var(--accent-b), 0); }
}
@keyframes pulseDown {
  0%   { box-shadow: 0 0 0 0 rgba(var(--danger-r),var(--danger-g),var(--danger-b), .35); }
  100% { box-shadow: 0 0 0 14px rgba(var(--danger-r),var(--danger-g),var(--danger-b), 0); }
}
.stepper{ position:relative; overflow:visible; }
.stepper.pulse-up   { border-color: var(--accent); animation: pulseUp .38s ease-out; }
.stepper.pulse-down { border-color: var(--danger); animation: pulseDown .38s ease-out; }


/* ---- v10: tame iOS blue focus ring & use accent ring ---- */
button:focus { outline: none; }
button:focus-visible { outline: none; }

/* More specific for our controls */
.seg-buttons button:focus-visible,
.stepper .ctr button:focus-visible,
.nav-tabs button:focus-visible,
.user-chip:focus-visible,
.period-tabs button:focus-visible,
button.ghost:focus-visible {
  border-color: var(--accent);
  box-shadow: none;
}


/* === v15 Summary cards & consistency === */
.summary-card{
  background: var(--card);
  border: 1px dashed var(--line);
  border-radius: 16px;
  padding: 14px;
  margin: 12px 0;
}
.summary-card h3{ margin: 0 0 8px 0; font-weight: 700; }

.consistency{ display:flex; gap:8px; margin-top:6px; }
.consistency .dot{ width:12px; height:12px; border-radius:4px; background: rgba(255,255,255,0.12); }
.consistency .dot.on{ background: var(--accent); }

/* Nudge Summary content below sticky tabs */
body[data-page="summary"] #summaryContent{ padding-top: 8px; }

/* Suggested workouts styles */
:root{ --suggest:#f5d061; }
.card.suggested{ outline: 2px dashed var(--suggest); outline-offset: -2px; }
.card.suggested .repsets{ border-color: var(--suggest); color: var(--suggest); }
.suggest-list{ display:flex; flex-direction:column; gap:8px; }
.suggest-item{ display:flex; align-items:center; gap:8px; }
.suggest-item .name{ flex:1; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.suggest-tag{ font-size:11px; padding:2px 8px; border-radius:999px; border:1px dashed var(--suggest); color:var(--suggest); }


/* v16b summary spacing + smaller type */
body[data-page="summary"] #summaryContent{ padding-top: 14px; }
#page-summary .summary h4{ font-size: 14px; line-height: 18px; }
#page-summary .summary, #page-summary .summary div, #page-summary .summary li{ font-size: 13px; line-height: 1.45; }

/* more breathing room around map text */
#mapWrap{ gap: 16px !important; }
#mapWrap > div:last-child{ padding-left: 2px; }

/* ===== Log modal layout overrides ===== */
#logModal #logTitle{
  text-align:center !important;
  margin:6px 0 0 !important;
  line-height:1.15 !important;
}
#logModal #logSub{
  text-align:center !important;
  margin:2px 0 12px !important;
  line-height:1.2 !important;
  display:block !important;
}

/* Remove default stack gap; use row margins for consistent spacing */
#logModal .stack{ gap:0 !important; }
/* Match vertical spacing between all rows (same as Fail Reps → Notes) */
#logModal .stack .row{
  margin:12px 0 !important;
  display:grid;
  gap:8px;
}

/* Side: Left / Both / Right as full-width grid */
#sideSeg{
  margin:6px 0 12px !important;
  display:grid !important;
  grid-template-columns:repeat(3, 1fr) !important;
  gap:8px !important;
}
#sideSeg button{
  width:100% !important;
  justify-content:center !important;
}

/* ▲ ▼ buttons: center and size nicely */
#logModal .stepper .up,
#logModal .stepper .down{
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  font-size:18px !important;
  line-height:1 !important;
  padding:0 !important;
}

/* Previous-set text consistency */
.weight .prevline{ font-weight:400 !important; }
#logSub .prevline{ display:inline !important; margin-left:6px !important; }


/* --- Dialog Form Styling Fixes --- */
.dialog-form {
    padding: 20px;
}

.dialog-form .input-group {
    margin-bottom: 16px;
}

.dialog-form input[type="text"],
.dialog-form input[type="number"],
.dialog-form textarea {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #444;
    width: 100%;
    box-sizing: border-box;
}

/* Equalize spacing between increment/decrement buttons */
.dialog-form .counter {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

/* Button styling */
.dialog-form button {
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    cursor: pointer;
}

.dialog-form .primary-btn {
    background-color: #00d1b2;
    color: #000;
}

.dialog-form .primary-btn:hover {
    background-color: #00b89c;
}

.dialog-form .secondary-btn {
    background-color: #333;
    color: #fff;
}

.dialog-form .secondary-btn:hover {
    background-color: #444;
}


/* --- Log Modal Buttons (tidy) --- */
#btnSkip{
  background:transparent;
  border:1px dashed var(--line);
  color:var(--muted);
  border-radius:12px;
}
#btnSkip:hover{ border-color:var(--fg-weak); color:var(--fg); }

#btnCancel{
  background:#171821;
  border:1px solid #2a2b33;
  color:#e6e6ea;
  border-radius:12px;
}
#btnCancel:hover{ background:#1d1e27; }

/* === Scoped log modal spacing (no impact to main page) === */
#logModal .stack{ gap:0 !important; }
#logModal .stack .row{ margin:12px 0 !important; }
#logModal .stack .row > *{ margin-top:0 !important; margin-bottom:0 !important; }
#logModal #sideSeg{ margin:12px 0 !important; }
#logModal menu{ margin:12px 0 0 !important; }
#logModal #logSub{ margin:2px 0 12px !important; }

/* Grid templates per row, based on actual children */
#logModal .stack .row{ display:grid; grid-template-columns: 1fr; width:100%; }
/* If a row has two steppers (e.g., Sets/Reps or Weight/Height), make it 2-up */
#logModal .stack .row:has(> .stepper + .stepper){ grid-template-columns: 1fr 1fr; }
/* Rows with a textarea (Notes) stay single column full-width */
#logModal .stack .row:has(> textarea){ grid-template-columns: 1fr; }
/* Rows with a single stepper (RPE, Fail reps) stay single column full-width */
#logModal .stack .row:has(> .stepper):not(:has(> .stepper + .stepper)){ grid-template-columns: 1fr; }

/* Ensure log modal rows and their controls span full width */
#logModal .stack .row > .stepper,
#logModal .stack .row > .seg,
#logModal .stack .row > textarea,
#logModal .stack .row > select,
#logModal .stack .row > input{ width:100%; }

/* Adjust only vertical rhythm in log modal */
#logModal .log-row + .log-row {
  margin-top: 12px;
}






/* === Log modal: sliding filled highlight for Left / Both / Right === */
#logModal #sideSeg{ position:relative; }
#logModal #sideSeg .seg-buttons{
  position:relative; overflow:hidden; border-radius:12px; padding:0; margin:0;
  display:grid; grid-template-columns:repeat(3,1fr); gap:0;
  contain: layout paint; /* isolate layout/paint during slider transform */
  height: 40px; /* fixed height to avoid reflow ripple effects */
}
#logModal #sideSeg .seg-buttons .highlight-bar{
  position:absolute; top:0; left:0; width:33.3333%; height:100%;
  background: var(--accent); border-radius:12px; z-index:0;
  transition: transform 220ms ease;
  pointer-events:none;      /* never affects layout/interaction */
  will-change: transform;   /* smoother, avoids layout thrash */
}
#logModal #sideSeg .seg-buttons.left  .highlight-bar{ transform: translateX(0%); }
#logModal #sideSeg .seg-buttons.both  .highlight-bar{ transform: translateX(100%); }
#logModal #sideSeg .seg-buttons.right .highlight-bar{ transform: translateX(200%); }
#logModal #sideSeg .seg-buttons button{
  position:relative; z-index:1; background:transparent; border:none; color:#e6e6ea;
  display:flex; align-items:center; justify-content:center; /* center in the 40px track */
  height:100%;
  line-height:1;
  transform: translateY(-1px); /* nudge text upward slightly */
}
#logModal #sideSeg .seg-buttons.left  button[data-side="left"],
#logModal #sideSeg .seg-buttons.both  button[data-side="both"],
#logModal #sideSeg .seg-buttons.right button[data-side="right"]{ color:#0b0b0c; font-weight:800; }


/* === Summary period tabs: refined filled slider (Week/Month/Year) === */
#page-summary .period-tabs{
  position:sticky; top:56px; z-index:40;
  display:grid; grid-template-columns:repeat(3,1fr); gap:0;
  background:#0f1015;
  border:1px solid #1f2028;
  border-radius:16px;
  padding:4px;
  height:48px; /* ensure consistent geometry */
}

#page-summary .period-tabs .highlight-bar{
  position:absolute; top:4px; left:4px;
  width:calc(33.3333% - 8px); height:calc(100% - 8px);
  background:var(--accent);
  border-radius:12px;
  transition:transform 220ms ease;
  will-change:transform;
  pointer-events:none;
  z-index:0;
}

#page-summary .period-tabs.week  .highlight-bar{ transform:translateX(0%); }
#page-summary .period-tabs.month .highlight-bar{ transform:translateX(100%); }
#page-summary .period-tabs.year  .highlight-bar{ transform:translateX(200%); }

#page-summary .period-tabs button{
  position:relative; z-index:1;
  background:transparent; border:none; outline:none;
  color:#e6e6ea;
  display:flex; align-items:center; justify-content:center; /* vertical centering */
  height:100%;
  margin:0; padding:2px 14px 0 14px; /* nudge text downward slightly */
  line-height:1;                       /* avoid baseline lift */
  border-radius:12px; font-weight:700;
  transform:none;                      /* cancel any global nudge */
}

#page-summary .period-tabs.week  button[data-period="week"],
#page-summary .period-tabs.month button[data-period="month"],
#page-summary .period-tabs.year  button[data-period="year"]{
  color:#0b0b0c; font-weight:800;
}